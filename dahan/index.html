<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§å¯’Â·å²æœ«è¿æ˜¥</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --ice: #60a5fa;
            --warm: #dc2626;
            --pink: #ec4899;
            --text: #f8fafc;
            --bg: #0f172a;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* é›ªèŠ±èƒŒæ™¯ */
        .snowflakes {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }
        
        /* å¤´éƒ¨ */
        .header {
            text-align: center;
            padding: 40px 20px;
            margin-bottom: 30px;
            border-radius: 20px;
            background: linear-gradient(135deg, var(--primary), #1e40af);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .title {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #f0f9ff, #dbeafe);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        /* å¡ç‰‡ç½‘æ ¼ */
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .card {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.3s;
        }
        
        .card:hover { transform: translateY(-5px); }
        
        .card-title {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            font-size: 1.4rem;
            color: var(--ice);
        }
        
        .card-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--ice));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        /* å¯’å†·ç°è±¡ */
        .phenomena { margin-top: 15px; }
        
        .phenomenon {
            background: rgba(255,255,255,0.05);
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid var(--ice);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .phenomenon:hover { background: rgba(96,165,250,0.1); }
        .phenomenon.checked { border-left-color: #fbbf24; }
        
        /* æ´»åŠ¨å¡ç‰‡ */
        .activities { display: grid; grid-template-columns: repeat(2,1fr); gap: 15px; margin-top: 15px; }
        
        .activity {
            background: rgba(255,255,255,0.07);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .activity:hover { border-color: var(--ice); transform: scale(1.05); }
        .activity.collected { background: rgba(37,99,235,0.2); border-color: var(--ice); }
        
        .activity-icon { font-size: 2rem; margin-bottom: 10px; }
        
        /* è¯—è¯é…å¯¹ */
        .poems { display: grid; grid-template-columns: repeat(2,1fr); gap: 12px; margin-top: 15px; }
        
        .poem {
            background: rgba(255,255,255,0.07);
            padding: 18px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            border: 2px solid rgba(255,255,255,0.1);
            transition: all 0.3s;
        }
        
        .poem:hover { border-color: var(--ice); }
        .poem.selected { background: rgba(37,99,235,0.2); }
        .poem.matched { background: rgba(34,197,94,0.2); cursor: default; }
        
        /* ç”»æ¿ */
        .drawing-board {
            width: 100%;
            height: 250px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            border: 2px solid rgba(255,255,255,0.1);
            margin: 15px 0;
            cursor: crosshair;
            display: block;
        }
        
        .colors {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        
        .color {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 3px solid rgba(255,255,255,0.2);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .color.active { border-color: white; box-shadow: 0 0 10px rgba(255,255,255,0.5); }
        
        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--primary), #1e40af);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.3s;
        }
        
        .btn:hover { transform: translateY(-3px); }
        
        /* æˆå°± */
        .achievements {
            background: rgba(30,64,175,0.2);
            padding: 30px;
            border-radius: 20px;
            margin-top: 40px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .progress-bar {
            width: 100%;
            height: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            margin: 20px 0 30px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--ice), var(--primary));
            width: 0%;
            transition: width 0.5s;
            border-radius: 10px;
        }
        
        .badges {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .badge {
            width: 80px;
            height: 80px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(255,255,255,0.1);
            transition: all 0.3s;
        }
        
        .badge.unlocked {
            background: rgba(96,165,250,0.2);
            border-color: var(--ice);
            transform: scale(1.1);
        }
        
        .badge-icon { font-size: 2rem; margin-bottom: 5px; }
        
        /* å¼¹çª— */
        .modal {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal.active { display: flex; }
        
        .modal-content {
            background: linear-gradient(135deg, #1e40af, var(--primary));
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            position: relative;
        }
        
        .modal-close {
            position: absolute;
            top: 15px; right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px; height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-close:hover { background: rgba(255,255,255,0.1); }
        
        /* éŸ³ä¹æ§åˆ¶ */
        .music-btn {
            position: fixed;
            bottom: 20px; right: 20px;
            width: 60px; height: 60px;
            background: linear-gradient(135deg, var(--primary), #1e40af);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        
        /* æç¤º */
        .toast {
            position: fixed;
            top: 20px; right: 20px;
            background: linear-gradient(135deg, #1e40af, var(--primary));
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 1000;
            transform: translateX(150%);
            transition: transform 0.3s;
            border-left: 4px solid var(--ice);
        }
        
        .toast.show { transform: translateX(0); }
        
        @media (max-width: 768px) {
            .cards { grid-template-columns: 1fr; }
            .activities, .poems { grid-template-columns: 1fr; }
            .title { font-size: 2rem; }
        }
    </style>
</head>
<body>
    <!-- é›ªèŠ± -->
    <div class="snowflakes" id="snowflakes"></div>
    
    <!-- ä¹ ä¿—å¼¹çª— -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">Ã—</button>
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                <div id="modalIcon" style="font-size: 2.5rem;"></div>
                <h3 id="modalTitle" style="font-size: 1.6rem;"></h3>
            </div>
            <div id="modalBody" style="line-height: 1.6;"></div>
        </div>
    </div>
    
    <!-- ä¸»å†…å®¹ -->
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <header class="header">
            <h1 class="title">å¤§å¯’Â·å²æœ«è¿æ˜¥</h1>
            <p style="opacity: 0.9;">äºŒåå››èŠ‚æ°”ä¹‹ç»ˆï¼Œä¸‡ç‰©é™å¾…æ–°ç”Ÿ</p>
        </header>
        
        <!-- å¡ç‰‡åŒº -->
        <div class="cards">
            <!-- å¯’å†·ç°è±¡ -->
            <div class="card">
                <div class="card-title">
                    <div class="card-icon"><i class="fas fa-snowflake"></i></div>
                    <h3>å¤§å¯’å†·å†½æ™¯è±¡</h3>
                </div>
                <p style="margin-bottom: 15px; opacity: 0.9;">ç‚¹å‡»äº†è§£å¤§å¯’æ—¶èŠ‚çš„ç‹¬ç‰¹æ™¯è±¡ï¼š</p>
                <div class="phenomena">
                    <div class="phenomenon" data-id="icicle">
                        <div style="font-weight: 600; margin-bottom: 5px;">å†°å‡Œå€’æŒ‚</div>
                        <div style="font-size: 0.9rem; opacity: 0.8;">å±‹æªä¸‹å½¢æˆæ™¶è¹å‰”é€çš„å†°å‡Œ</div>
                    </div>
                    <div class="phenomenon" data-id="ice">
                        <div style="font-weight: 600; margin-bottom: 5px;">æ°´é¢ç»“åšå†°</div>
                        <div style="font-size: 0.9rem; opacity: 0.8;">æ¹–æ³Šæ± å¡˜ç»“å‡ºå¯æ‰¿é‡çš„åšå†°å±‚</div>
                    </div>
                    <div class="phenomenon" data-id="frost">
                        <div style="font-weight: 600; margin-bottom: 5px;">éœœèŠ±æ»¡çª—</div>
                        <div style="font-size: 0.9rem; opacity: 0.8;">æ¸…æ™¨ç»ç’ƒçª—å‡ç»“ç²¾ç¾éœœèŠ±å›¾æ¡ˆ</div>
                    </div>
                </div>
            </div>
            
            <!-- å²æœ«æ´»åŠ¨ -->
            <div class="card">
                <div class="card-title">
                    <div class="card-icon"><i class="fas fa-home"></i></div>
                    <h3>å¤§å¯’æš–å¿ƒæ´»åŠ¨</h3>
                </div>
                <p style="margin-bottom: 15px; opacity: 0.9;">ç‚¹å‡»äº†è§£å²æœ«å¯ä»¥åšçš„æ¸©æš–å°äº‹ï¼š</p>
                <div class="activities">
                    <div class="activity" data-id="rice" data-title="ç…®ç³¯ç±³é¥­" data-icon="ğŸš">
                        <div class="activity-icon">ğŸš</div>
                        <div style="font-weight: 500;">ç…®ç³¯ç±³é¥­</div>
                    </div>
                    <div class="activity" data-id="soup" data-title="ç‚–é¸¡æ±¤" data-icon="ğŸ²">
                        <div class="activity-icon">ğŸ²</div>
                        <div style="font-weight: 500;">ç‚–é¸¡æ±¤</div>
                    </div>
                    <div class="activity" data-id="clean" data-title="é™¤å°˜è¿æ–°" data-icon="ğŸ§¹">
                        <div class="activity-icon">ğŸ§¹</div>
                        <div style="font-weight: 500;">é™¤å°˜è¿æ–°</div>
                    </div>
                    <div class="activity" data-id="prepare" data-title="å¤‡å¹´è´§" data-icon="ğŸ">
                        <div class="activity-icon">ğŸ</div>
                        <div style="font-weight: 500;">å¤‡å¹´è´§</div>
                    </div>
                </div>
            </div>
            
            <!-- è¯—è¯ -->
            <div class="card">
                <div class="card-title">
                    <div class="card-icon"><i class="fas fa-feather-alt"></i></div>
                    <h3>å¤§å¯’è¯—è¯å¯¹éŸµ</h3>
                </div>
                <p style="margin-bottom: 15px; opacity: 0.9;">é…å¯¹å®Œæ•´çš„å¤§å¯’è¯—å¥ï¼š</p>
                <div class="poems">
                    <div class="poem" data-line="1">å¤§å¯’é›ªæœªæ¶ˆ</div>
                    <div class="poem" data-line="2">é—­æˆ·ä¸èƒ½å‡º</div>
                    <div class="poem" data-line="3">å¯æ€œåˆ‡äº‘å† </div>
                    <div class="poem" data-line="4">å±€æ­¤å®¹è†å®¤</div>
                </div>
            </div>
            
            <!-- ç”»æ¿ -->
            <div class="card">
                <div class="card-title">
                    <div class="card-icon"><i class="fas fa-paint-brush"></i></div>
                    <h3>ç»˜å‡ºå†¬æ—¥æš–æ„</h3>
                </div>
                <p style="margin-bottom: 15px; opacity: 0.9;">ç»˜åˆ¶ä½ å¿ƒä¸­çš„å†¬æ—¥æ™¯è±¡ï¼š</p>
                <canvas class="drawing-board" id="canvas"></canvas>
                <div class="colors">
                    <div class="color active" style="background: #dc2626;" data-color="#dc2626"></div>
                    <div class="color" style="background: #ec4899;" data-color="#ec4899"></div>
                    <div class="color" style="background: #2563eb;" data-color="#2563eb"></div>
                    <div class="color" style="background: #059669;" data-color="#059669"></div>
                    <div class="color" style="background: #d97706;" data-color="#d97706"></div>
                    <div class="color" style="background: #7c3aed;" data-color="#7c3aed"></div>
                    <div class="color" style="background: #000000;" data-color="#000000"></div>
                </div>
                <div class="buttons">
                    <button class="btn" id="clearBtn"><i class="fas fa-trash-alt"></i>æ¸…ç©º</button>
                    <button class="btn" id="saveBtn"><i class="fas fa-download"></i>ä¿å­˜</button>
                </div>
            </div>
        </div>
        
        <!-- æˆå°± -->
        <section class="achievements">
            <h3 style="text-align: center; font-size: 1.6rem; margin-bottom: 10px;">èŠ‚æ°”æˆå°±</h3>
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
            <div class="badges">
                <div class="badge" id="badge1">
                    <div class="badge-icon">â„ï¸</div>
                    <div style="font-size: 0.8rem;">å¯’å†¬è§‚å¯Ÿè€…</div>
                </div>
                <div class="badge" id="badge2">
                    <div class="badge-icon">â­</div>
                    <div style="font-size: 0.8rem;">æš–å¿ƒç”Ÿæ´»å®¶</div>
                </div>
                <div class="badge" id="badge3">
                    <div class="badge-icon">ğŸ“š</div>
                    <div style="font-size: 0.8rem;">è¯—è¯çŸ¥éŸ³</div>
                </div>
                <div class="badge" id="badge4">
                    <div class="badge-icon">ğŸ¨</div>
                    <div style="font-size: 0.8rem;">å†¬æ—¥ç”»å®¶</div>
                </div>
            </div>
        </section>
    </div>
    
    <!-- éŸ³ä¹æ§åˆ¶ -->
    <button class="music-btn" id="musicBtn">
        <i class="fas fa-music"></i>
    </button>
    
    <!-- æç¤º -->
    <div class="toast" id="toast"></div>
    
    <!-- éŸ³é¢‘ -->
    <audio id="music" loop preload="auto">
        <source src="https://assets.mixkit.co/music/preview/mixkit-winter-snow-125.mp3" type="audio/mpeg">
    </audio>
    
    <script>
        // çŠ¶æ€ç®¡ç†
        const state = {
            phenomena: new Set(),
            activities: new Set(),
            poems: new Set(),
            hasDrawn: false,
            progress: 10
        };
        
        // å…ƒç´ å¼•ç”¨
        const elements = {
            snowflakes: document.getElementById('snowflakes'),
            canvas: document.getElementById('canvas'),
            progress: document.getElementById('progress'),
            toast: document.getElementById('toast'),
            musicBtn: document.getElementById('musicBtn'),
            music: document.getElementById('music'),
            modal: document.getElementById('modal'),
            modalClose: document.getElementById('modalClose'),
            modalIcon: document.getElementById('modalIcon'),
            modalTitle: document.getElementById('modalTitle'),
            modalBody: document.getElementById('modalBody')
        };
        
        // æ´»åŠ¨è¯¦æƒ…
        const activityDetails = {
            rice: {
                title: 'ç…®ç³¯ç±³é¥­',
                icon: 'ğŸš',
                desc: 'å¤§å¯’æ—¶èŠ‚ï¼Œç…®ä¸€é”…çƒ­è…¾è…¾çš„ç³¯ç±³é¥­ï¼Œæš–å¿ƒåˆæš–èƒƒã€‚å¯åŠ å…¥çº¢æ£ã€èŠ±ç”Ÿç­‰é£Ÿæï¼Œæ—¢ç¾å‘³åˆé©±å¯’ã€‚'
            },
            soup: {
                title: 'ç‚–é¸¡æ±¤',
                icon: 'ğŸ²',
                desc: 'ç‚–ä¸€é”…è¥å…»ä¸°å¯Œçš„é¸¡æ±¤ï¼Œè¡¥å……ä½“åŠ›å¢å¼ºå…ç–«åŠ›ã€‚å¯åŠ å…¥æ¸æã€å½“å½’ç­‰è¯æï¼Œå…¨å®¶å…±äº«æ¸©æš–ã€‚'
            },
            clean: {
                title: 'é™¤å°˜è¿æ–°',
                icon: 'ğŸ§¹',
                desc: 'å¤§æ‰«é™¤è¿æ¥æ–°å¹´ï¼Œæ•´ç†å®¶å±…ç¯å¢ƒï¼Œæ‰«é™¤æ—§å²å°˜åŸƒï¼Œä»¥æ•´æ´é¢è²Œè¿æ¥æ–°æ˜¥åˆ°æ¥ã€‚'
            },
            prepare: {
                title: 'å¤‡å¹´è´§',
                icon: 'ğŸ',
                desc: 'å¼€å§‹å‡†å¤‡å¹´è´§ï¼ŒæŒ‘é€‰æ˜¥è”ã€é£Ÿå“ã€æ–°è¡£ç­‰ï¼Œæ„Ÿå—æ¸æµ“çš„å¹´å‘³ï¼ŒæœŸå¾…å›¢åœ†æ—¶åˆ»ã€‚'
            }
        };
        
        // åˆå§‹åŒ–
        function init() {
            createSnowflakes();
            setupDrawing();
            setupInteractions();
            updateProgress();
        }
        
        // åˆ›å»ºé›ªèŠ±
        function createSnowflakes() {
            for (let i = 0; i < 40; i++) {
                const flake = document.createElement('div');
                flake.style.cssText = `
                    position: absolute;
                    background: white;
                    border-radius: 50%;
                    width: ${Math.random() * 4 + 2}px;
                    height: ${Math.random() * 4 + 2}px;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    opacity: ${Math.random() * 0.5 + 0.3};
                    animation: fall ${Math.random() * 10 + 10}s linear infinite;
                `;
                elements.snowflakes.appendChild(flake);
            }
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fall {
                    0% { transform: translateY(-100px) rotate(0deg); }
                    100% { transform: translateY(100vh) rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
        }
        
        // è®¾ç½®ç”»æ¿
        function setupDrawing() {
            const ctx = elements.canvas.getContext('2d');
            elements.canvas.width = elements.canvas.offsetWidth;
            elements.canvas.height = elements.canvas.offsetHeight;
            
            let drawing = false;
            let color = '#dc2626';
            
            ctx.lineWidth = 8;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.strokeStyle = color;
            
            // é¢œè‰²é€‰æ‹©
            document.querySelectorAll('.color').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.color').forEach(c => c.classList.remove('active'));
                    btn.classList.add('active');
                    color = btn.dataset.color;
                    ctx.strokeStyle = color;
                });
            });
            
            // ç»˜ç”»äº‹ä»¶
            elements.canvas.addEventListener('mousedown', start);
            elements.canvas.addEventListener('mousemove', draw);
            elements.canvas.addEventListener('mouseup', end);
            elements.canvas.addEventListener('mouseout', end);
            
            elements.canvas.addEventListener('touchstart', e => {
                e.preventDefault();
                start(e.touches[0]);
            });
            
            elements.canvas.addEventListener('touchmove', e => {
                e.preventDefault();
                draw(e.touches[0]);
            });
            
            elements.canvas.addEventListener('touchend', end);
            
            function start(e) {
                drawing = true;
                if (!state.hasDrawn) {
                    state.hasDrawn = true;
                    updateProgress(15);
                    unlockBadge('badge4');
                    showMessage('ğŸ¨ å¼€å§‹åˆ›ä½œï¼');
                }
                const rect = elements.canvas.getBoundingClientRect();
                ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
            }
            
            function draw(e) {
                if (!drawing) return;
                const rect = elements.canvas.getBoundingClientRect();
                ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
                ctx.stroke();
            }
            
            function end() {
                drawing = false;
                ctx.beginPath();
            }
            
            // æ¸…ç©ºç”»å¸ƒ
            document.getElementById('clearBtn').addEventListener('click', () => {
                ctx.clearRect(0, 0, elements.canvas.width, elements.canvas.height);
                showMessage('ç”»æ¿å·²æ¸…ç©º');
            });
            
            // ä¿å­˜ä½œå“
            document.getElementById('saveBtn').addEventListener('click', () => {
                const link = document.createElement('a');
                link.download = 'å¤§å¯’ç»˜ç”».png';
                link.href = elements.canvas.toDataURL();
                link.click();
                showMessage('ä½œå“å·²ä¿å­˜ï¼');
            });
            
            // çª—å£å¤§å°è°ƒæ•´
            window.addEventListener('resize', () => {
                const imgData = ctx.getImageData(0, 0, elements.canvas.width, elements.canvas.height);
                elements.canvas.width = elements.canvas.offsetWidth;
                elements.canvas.height = elements.canvas.offsetHeight;
                ctx.putImageData(imgData, 0, 0);
                ctx.lineWidth = 8;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.strokeStyle = color;
            });
        }
        
        // è®¾ç½®äº¤äº’
        function setupInteractions() {
            // å¯’å†·ç°è±¡
            document.querySelectorAll('.phenomenon').forEach(item => {
                item.addEventListener('click', () => {
                    if (!item.classList.contains('checked')) {
                        item.classList.add('checked');
                        state.phenomena.add(item.dataset.id);
                        updateProgress(5);
                        
                        if (state.phenomena.size === 1) {
                            unlockBadge('badge1');
                            showMessage('â„ï¸ è§‚å¯Ÿåˆ°å¯’å†·æ™¯è±¡ï¼');
                        }
                    }
                });
            });
            
            // æ´»åŠ¨è¯¦æƒ…
            document.querySelectorAll('.activity').forEach(item => {
                item.addEventListener('click', () => {
                    const id = item.dataset.id;
                    
                    // æ˜¾ç¤ºè¯¦æƒ…
                    const detail = activityDetails[id];
                    if (detail) {
                        elements.modalIcon.textContent = detail.icon;
                        elements.modalTitle.textContent = detail.title;
                        elements.modalBody.textContent = detail.desc;
                        elements.modal.classList.add('active');
                    }
                    
                    // æ”¶é›†
                    if (!item.classList.contains('collected')) {
                        item.classList.add('collected');
                        state.activities.add(id);
                        updateProgress(8);
                        
                        if (state.activities.size === 4) {
                            unlockBadge('badge2');
                            showMessage('ğŸŒŸ æ”¶é›†äº†æ‰€æœ‰æš–å¿ƒæ´»åŠ¨ï¼');
                        }
                    }
                });
            });
            
            // è¯—è¯é…å¯¹
            const poemPairs = { '1': '2', '3': '4' };
            let selected = null;
            
            document.querySelectorAll('.poem').forEach(poem => {
                poem.addEventListener('click', () => {
                    if (poem.classList.contains('matched')) return;
                    
                    if (!selected) {
                        selected = poem;
                        poem.classList.add('selected');
                    } else {
                        const first = selected.dataset.line;
                        const second = poem.dataset.line;
                        
                        if (poemPairs[first] === second || poemPairs[second] === first) {
                            selected.classList.remove('selected');
                            selected.classList.add('matched');
                            poem.classList.add('matched');
                            
                            state.poems.add(first);
                            updateProgress(10);
                            
                            if (state.poems.size === 2) {
                                unlockBadge('badge3');
                                showMessage('ğŸ“š è¯—è¯é…å¯¹å®Œæˆï¼');
                            }
                        } else {
                            selected.classList.remove('selected');
                            showMessage('å†è¯•ä¸€æ¬¡å§~');
                        }
                        selected = null;
                    }
                });
            });
            
            // å¼¹çª—å…³é—­
            elements.modalClose.addEventListener('click', () => {
                elements.modal.classList.remove('active');
            });
            
            elements.modal.addEventListener('click', (e) => {
                if (e.target === elements.modal) {
                    elements.modal.classList.remove('active');
                }
            });
            
            // éŸ³ä¹æ§åˆ¶
            let playing = false;
            elements.musicBtn.addEventListener('click', () => {
                if (playing) {
                    elements.music.pause();
                    elements.musicBtn.innerHTML = '<i class="fas fa-music"></i>';
                } else {
                    elements.music.play().catch(() => {
                        showMessage('ç‚¹å‡»é¡µé¢ä»»æ„å¤„å¯ç”¨éŸ³ä¹');
                        document.addEventListener('click', () => {
                            elements.music.play();
                        }, { once: true });
                    });
                    elements.musicBtn.innerHTML = '<i class="fas fa-pause"></i>';
                }
                playing = !playing;
            });
        }
        
        // æ›´æ–°è¿›åº¦
        function updateProgress(add = 0) {
            if (add) state.progress = Math.min(100, state.progress + add);
            
            // æ£€æŸ¥å®Œæˆåº¦
            const complete = 
                state.phenomena.size >= 1 &&
                state.activities.size === 4 &&
                state.poems.size === 2 &&
                state.hasDrawn;
            
            if (complete && state.progress < 100) {
                state.progress = 100;
            }
            
            elements.progress.style.width = state.progress + '%';
            
            if (state.progress >= 100) {
                setTimeout(() => showMessage('ğŸ‰ å¤§å¯’èŠ‚æ°”æ¢ç´¢å®Œæˆï¼'), 500);
            }
        }
        
        // è§£é”å¾½ç« 
        function unlockBadge(id) {
            const badge = document.getElementById(id);
            badge.classList.add('unlocked');
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(text) {
            elements.toast.textContent = text;
            elements.toast.classList.add('show');
            setTimeout(() => {
                elements.toast.classList.remove('show');
            }, 2000);
        }
        
        // å¯åŠ¨
        init();
    </script>
</body>
</html>
