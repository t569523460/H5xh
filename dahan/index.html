<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤§å¯’Â·å²æœ«è¿æ˜¥ | äº’åŠ¨èŠ‚æ°”H5</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #2563eb;
            --ice: #60a5fa;
            --warm: #dc2626;
            --pink: #ec4899;
            --text: #f8fafc;
            --bg: #0f172a;
        }
        
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow: hidden;
            height: 100vh;
        }
        
        /* é¡µé¢å®¹å™¨ */
        .pages-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .page {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            opacity: 0;
            transform: translateY(100%);
        }
        
        .page.active {
            opacity: 1;
            transform: translateY(0);
        }
        
        .page.next {
            transform: translateY(100%);
        }
        
        .page.prev {
            transform: translateY(-100%);
        }
        
        /* é›ªèŠ±èƒŒæ™¯ */
        .snow-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
        /* é€šç”¨å¡ç‰‡æ ·å¼ */
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px 30px;
            max-width: 500px;
            width: 90%;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 2;
            text-align: center;
        }
        
        .title {
            font-size: 2.5rem;
            margin-bottom: 20px;
            background: linear-gradient(45deg, var(--ice), var(--text));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .desc {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 30px;
            opacity: 0.9;
        }
        
        /* å¯’å†·ç°è±¡é¡µé¢ */
        .phenomenon-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .phenomenon-item {
            background: rgba(255, 255, 255, 0.08);
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid var(--ice);
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .phenomenon-item:hover {
            background: rgba(96, 165, 250, 0.15);
            transform: translateX(10px);
        }
        
        .phenomenon-item.checked::after {
            content: 'âœ“';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #4ade80;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        /* æ´»åŠ¨é¡µé¢ */
        .activities-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 25px;
        }
        
        .activity-item {
            background: rgba(255, 255, 255, 0.07);
            padding: 25px 15px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .activity-item:hover {
            border-color: var(--ice);
            transform: scale(1.05);
        }
        
        .activity-item.collected {
            background: rgba(37, 99, 235, 0.2);
            border-color: var(--ice);
        }
        
        .activity-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        /* è¯—è¯é¡µé¢ */
        .poem-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 25px;
        }
        
        .poem-line {
            background: rgba(255, 255, 255, 0.07);
            padding: 25px 15px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            font-style: italic;
        }
        
        .poem-line:hover {
            border-color: var(--ice);
        }
        
        .poem-line.selected {
            background: rgba(37, 99, 235, 0.2);
            border-color: var(--primary);
        }
        
        .poem-line.matched {
            background: rgba(34, 197, 94, 0.2);
            border-color: #4ade80;
            cursor: default;
        }
        
        /* ç”»æ¿é¡µé¢ */
        .canvas-container {
            width: 100%;
            height: 250px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            margin: 25px 0;
            overflow: hidden;
        }
        
        #drawingCanvas {
            width: 100%;
            height: 100%;
            cursor: crosshair;
            display: block;
        }
        
        .color-palette {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .color-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .color-btn.active {
            border-color: white;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }
        
        .tool-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .action-btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, var(--primary), #1e40af);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            transition: transform 0.3s;
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
        }
        
        /* æˆå°±é¡µé¢ */
        .badges-container {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .badge {
            width: 90px;
            height: 90px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }
        
        .badge.unlocked {
            background: rgba(96, 165, 250, 0.2);
            border-color: var(--ice);
            transform: scale(1.1);
        }
        
        .badge-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin: 30px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--ice), var(--primary));
            width: 0%;
            transition: width 0.8s;
            border-radius: 5px;
        }
        
        /* æ»‘åŠ¨æç¤º */
        .scroll-hint {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            z-index: 10;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
            40% { transform: translateX(-50%) translateY(-10px); }
            60% { transform: translateX(-50%) translateY(-5px); }
        }
        
        .scroll-hint i {
            font-size: 1.5rem;
        }
        
        /* éŸ³ä¹æ§åˆ¶ */
        .music-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
        }
        
        .music-btn {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), #1e40af);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }
        
        /* æç¤ºæ¶ˆæ¯ */
        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.9), rgba(30, 64, 175, 0.9));
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 1000;
            transform: translateX(150%);
            transition: transform 0.3s;
            border-left: 4px solid var(--ice);
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        /* ä¸‹ä¸€é¡µæŒ‰é’® */
        .next-page-btn {
            margin-top: 30px;
            padding: 15px 40px;
            background: linear-gradient(135deg, var(--primary), #1e40af);
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .next-page-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.4);
        }
        
        .next-page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* é¡µé¢è®¡æ•° */
        .page-counter {
            position: absolute;
            top: 30px;
            right: 30px;
            font-size: 1rem;
            opacity: 0.7;
            z-index: 10;
        }
        
        /* æ´»åŠ¨è¯¦æƒ…å¼¹çª— */
        .activity-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .activity-modal.active {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.95), rgba(37, 99, 235, 0.9));
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            position: relative;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        @media (max-width: 768px) {
            .title { font-size: 2rem; }
            .card { padding: 30px 20px; }
            .activities-grid { grid-template-columns: 1fr; }
            .poem-grid { grid-template-columns: 1fr; }
            .scroll-hint { bottom: 20px; }
        }
    </style>
</head>
<body>
    <!-- é›ªèŠ±èƒŒæ™¯ -->
    <div class="snow-bg" id="snowBg"></div>
    
    <!-- æ´»åŠ¨è¯¦æƒ…å¼¹çª— -->
    <div class="activity-modal" id="activityModal">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">Ã—</button>
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                <div id="modalIcon" style="font-size: 2.5rem;"></div>
                <h3 id="modalTitle" style="font-size: 1.6rem;"></h3>
            </div>
            <div id="modalBody" style="line-height: 1.6;"></div>
        </div>
    </div>
    
    <!-- é¡µé¢å®¹å™¨ -->
    <div class="pages-container" id="pagesContainer">
        <!-- ç¬¬1é¡µï¼šå°é¢ -->
        <div class="page active" id="page1">
            <div class="card">
                <h1 class="title">å¤§å¯’Â·å²æœ«è¿æ˜¥</h1>
                <p class="desc">äºŒåå››èŠ‚æ°”ä¹‹ç»ˆï¼Œå†¬çš„æè‡´ï¼Œæ˜¥çš„å‰å¥</p>
                <p class="desc" style="margin-top: 20px;">å‘ä¸‹æ»‘åŠ¨ï¼Œå¼€å§‹æ¢ç´¢å¤§å¯’èŠ‚æ°”</p>
            </div>
            <div class="scroll-hint">
                <i class="fas fa-chevron-down"></i>
                <span>å‘ä¸‹æ»‘åŠ¨ç»§ç»­</span>
            </div>
        </div>
        
        <!-- ç¬¬2é¡µï¼šå¯’å†·ç°è±¡ -->
        <div class="page" id="page2">
            <div class="page-counter">2/6</div>
            <div class="card">
                <h2 class="title">å¤§å¯’å†·å†½æ™¯è±¡</h2>
                <p class="desc">ç‚¹å‡»äº†è§£å¤§å¯’æ—¶èŠ‚çš„ç‹¬ç‰¹æ™¯è±¡ï¼š</p>
                <div class="phenomenon-list">
                    <div class="phenomenon-item" data-id="icicle">
                        <div style="font-weight: 600; margin-bottom: 5px;">â„ï¸ å†°å‡Œå€’æŒ‚</div>
                        <div style="font-size: 0.95rem; opacity: 0.9;">å±‹æªä¸‹å½¢æˆæ™¶è¹å‰”é€çš„å†°å‡Œ</div>
                    </div>
                    <div class="phenomenon-item" data-id="ice">
                        <div style="font-weight: 600; margin-bottom: 5px;">ğŸ§Š æ°´é¢ç»“åšå†°</div>
                        <div style="font-size: 0.95rem; opacity: 0.9;">æ¹–æ³Šæ± å¡˜ç»“å‡ºå¯æ‰¿é‡çš„åšå†°å±‚</div>
                    </div>
                    <div class="phenomenon-item" data-id="frost">
                        <div style="font-weight: 600; margin-bottom: 5px;">â„ï¸ éœœèŠ±æ»¡çª—</div>
                        <div style="font-size: 0.95rem; opacity: 0.9;">æ¸…æ™¨ç»ç’ƒçª—å‡ç»“ç²¾ç¾éœœèŠ±å›¾æ¡ˆ</div>
                    </div>
                </div>
                <button class="next-page-btn" id="nextPage2" disabled>
                    <i class="fas fa-lock"></i> è¯·å…ˆç‚¹å‡»æ‰€æœ‰ç°è±¡
                </button>
            </div>
        </div>
        
        <!-- ç¬¬3é¡µï¼šå¤§å¯’æ´»åŠ¨ -->
        <div class="page" id="page3">
            <div class="page-counter">3/6</div>
            <div class="card">
                <h2 class="title">å¤§å¯’è¿˜èƒ½åšè¿™äº›</h2>
                <p class="desc">ç‚¹å‡»æŸ¥çœ‹ï¼Œæ„Ÿå—å†¬æ—¥æ¸©æš–ï¼š</p>
                <div class="activities-grid">
                    <div class="activity-item" data-id="rice" data-title="ç…®ç³¯ç±³é¥­" data-icon="ğŸš">
                        <div class="activity-icon">ğŸš</div>
                        <div style="font-weight: 500;">ç…®ç³¯ç±³é¥­</div>
                    </div>
                    <div class="activity-item" data-id="soup" data-title="ç‚–é¸¡æ±¤" data-icon="ğŸ²">
                        <div class="activity-icon">ğŸ²</div>
                        <div style="font-weight: 500;">ç‚–é¸¡æ±¤</div>
                    </div>
                    <div class="activity-item" data-id="clean" data-title="é™¤å°˜è¿æ–°" data-icon="ğŸ§¹">
                        <div class="activity-icon">ğŸ§¹</div>
                        <div style="font-weight: 500;">é™¤å°˜è¿æ–°</div>
                    </div>
                    <div class="activity-item" data-id="prepare" data-title="å¤‡å¹´è´§" data-icon="ğŸ®">
                        <div class="activity-icon">ğŸ®</div>
                        <div style="font-weight: 500;">å¤‡å¹´è´§</div>
                    </div>
                </div>
                <button class="next-page-btn" id="nextPage3" disabled>
                    <i class="fas fa-lock"></i> è¯·å…ˆç‚¹å‡»äº†è§£æ´»åŠ¨
                </button>
            </div>
        </div>
        
        <!-- ç¬¬4é¡µï¼šè¯—è¯é…å¯¹ -->
        <div class="page" id="page4">
            <div class="page-counter">4/6</div>
            <div class="card">
                <h2 class="title">å¤§å¯’è¯—è¯å¯¹éŸµ</h2>
                <p class="desc">å“å‘³å¤äººç¬”ä¸‹çš„å¤§å¯’ï¼Œé…å¯¹å®Œæ•´è¯—å¥ï¼š</p>
                <div class="poem-grid">
                    <div class="poem-line" data-line="1">å¤§å¯’é›ªæœªæ¶ˆ</div>
                    <div class="poem-line" data-line="2">é—­æˆ·ä¸èƒ½å‡º</div>
                    <div class="poem-line" data-line="3">å±€æ­¤å®¹è†å®¤</div>
                    <div class="poem-line" data-line="4">å¯æ€œåˆ‡äº‘å† </div>
                </div>
                <button class="next-page-btn" id="nextPage4" disabled>
                    <i class="fas fa-lock"></i> è¯·å…ˆå®Œæˆè¯—è¯é…å¯¹
                </button>
            </div>
        </div>
        
        <!-- ç¬¬5é¡µï¼šç»˜ç”» -->
        <div class="page" id="page5">
            <div class="page-counter">5/6</div>
            <div class="card">
                <h2 class="title">ç»˜å‡ºå†¬æ—¥æš–æ„</h2>
                <p class="desc">ç”¨ç”»ç¬”æç»˜ä½ å¿ƒä¸­çš„å†¬æ—¥æ™¯è±¡ï¼š</p>
                <div class="canvas-container">
                    <canvas id="drawingCanvas"></canvas>
                </div>
                <div class="color-palette">
                    <div class="color-btn active" style="background: #dc2626;" data-color="#dc2626"></div>
                    <div class="color-btn" style="background: #ec4899;" data-color="#ec4899"></div>
                    <div class="color-btn" style="background: #2563eb;" data-color="#2563eb"></div>
                    <div class="color-btn" style="background: #059669;" data-color="#059669"></div>
                    <div class="color-btn" style="background: #d97706;" data-color="#d97706"></div>
                    <div class="color-btn" style="background: #000000;" data-color="#000000"></div>
                </div>
                <div class="tool-buttons">
                    <button class="action-btn" id="clearCanvas">
                        <i class="fas fa-trash-alt"></i> æ¸…ç©º
                    </button>
                    <button class="action-btn" id="saveDrawing">
                        <i class="fas fa-download"></i> ä¿å­˜
                    </button>
                </div>
                <button class="next-page-btn" id="nextPage5" disabled>
                    <i class="fas fa-lock"></i> è¯·å…ˆå¼€å§‹ç»˜ç”»
                </button>
            </div>
        </div>
        
        <!-- ç¬¬6é¡µï¼šæˆå°± -->
        <div class="page" id="page6">
            <div class="page-counter">6/6</div>
            <div class="card">
                <h2 class="title">èŠ‚æ°”æˆå°±</h2>
                <p class="desc">å®Œæˆæ‰€æœ‰äº’åŠ¨ï¼Œè§£é”èŠ‚æ°”æˆå°±ï¼š</p>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                
                <div class="badges-container">
                    <div class="badge" id="badge1">
                        <div class="badge-icon">â„ï¸</div>
                        <div style="font-size: 0.85rem;">å¯’å†¬è§‚å¯Ÿè€…</div>
                    </div>
                    <div class="badge" id="badge2">
                        <div class="badge-icon">â­</div>
                        <div style="font-size: 0.85rem;">æš–å¿ƒç”Ÿæ´»å®¶</div>
                    </div>
                    <div class="badge" id="badge3">
                        <div class="badge-icon">ğŸ“š</div>
                        <div style="font-size: 0.85rem;">è¯—è¯çŸ¥éŸ³</div>
                    </div>
                    <div class="badge" id="badge4">
                        <div class="badge-icon">ğŸ¨</div>
                        <div style="font-size: 0.85rem;">å†¬æ—¥ç”»å®¶</div>
                    </div>
                </div>
                
                <p class="desc" style="margin-top: 30px;">å¤§å¯’å·²è¿‡ï¼Œæ–°æ˜¥å°†è‡³</p>
                <button class="next-page-btn" id="restartBtn">
                    <i class="fas fa-redo"></i> é‡æ–°å¼€å§‹
                </button>
            </div>
        </div>
    </div>
    
    <!-- éŸ³ä¹æ§åˆ¶ -->
    <div class="music-control">
        <button class="music-btn" id="musicBtn">
            <i class="fas fa-music"></i>
        </button>
    </div>
    
    <!-- æç¤ºæ¶ˆæ¯ -->
    <div class="toast" id="toast"></div>
    
    <!-- éŸ³é¢‘ -->
    <audio id="bgm" loop preload="auto">
        <source src="dahanbgm.mp3" type="audio/mpeg">
    </audio>

    <script>
        // çŠ¶æ€ç®¡ç†
        const state = {
            currentPage: 1,
            totalPages: 6,
            phenomena: new Set(),
            activities: new Set(),
            poems: new Set(),
            hasDrawn: false,
            achievements: {
                cold: false,
                activity: false,
                poem: false,
                paint: false
            },
            progress: 0
        };

        // æ´»åŠ¨è¯¦æƒ…æ•°æ®
        const activityDetails = {
            rice: {
                title: 'ç…®ç³¯ç±³é¥­',
                icon: 'ğŸš',
                desc: 'å¤§å¯’æ—¶èŠ‚ï¼Œç…®ä¸€é”…çƒ­è…¾è…¾çš„ç³¯ç±³é¥­ï¼Œæš–å¿ƒåˆæš–èƒƒã€‚å¯åŠ å…¥çº¢æ£ã€èŠ±ç”Ÿç­‰é£Ÿæï¼Œæ—¢ç¾å‘³åˆé©±å¯’ã€‚'
            },
            soup: {
                title: 'ç‚–é¸¡æ±¤',
                icon: 'ğŸ²',
                desc: 'ç‚–ä¸€é”…è¥å…»ä¸°å¯Œçš„é¸¡æ±¤ï¼Œè¡¥å……ä½“åŠ›å¢å¼ºå…ç–«åŠ›ã€‚å¯åŠ å…¥æ¸æã€å½“å½’ç­‰è¯æï¼Œå…¨å®¶å…±äº«æ¸©æš–ã€‚'
            },
            clean: {
                title: 'é™¤å°˜è¿æ–°',
                icon: 'ğŸ§¹',
                desc: 'å¤§æ‰«é™¤è¿æ¥æ–°å¹´ï¼Œæ•´ç†å®¶å±…ç¯å¢ƒï¼Œæ‰«é™¤æ—§å²å°˜åŸƒï¼Œä»¥æ•´æ´é¢è²Œè¿æ¥æ–°æ˜¥åˆ°æ¥ã€‚'
            },
            prepare: {
                title: 'å¤‡å¹´è´§',
                icon: 'ğŸ®',
                desc: 'å¼€å§‹å‡†å¤‡å¹´è´§ï¼ŒæŒ‘é€‰æ˜¥è”ã€é£Ÿå“ã€æ–°è¡£ç­‰ï¼Œæ„Ÿå—æ¸æµ“çš„å¹´å‘³ï¼ŒæœŸå¾…å›¢åœ†æ—¶åˆ»ã€‚'
            }
        };

        // é¡µé¢æ»šåŠ¨æ§åˆ¶
        let isScrolling = false;
        let startY = 0;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            initSnow();
            initCanvas();
            setupInteractions();
            initMusic();
            updateProgress();
            
            // è§¦æ‘¸äº‹ä»¶ç›‘å¬
            document.addEventListener('touchstart', handleTouchStart);
            document.addEventListener('touchend', handleTouchEnd);
            document.addEventListener('wheel', handleWheel);
            
            // é”®ç›˜æ”¯æŒ
            document.addEventListener('keydown', handleKeydown);
        });

        // åˆ›å»ºé›ªèŠ±
        function initSnow() {
            const bg = document.getElementById('snowBg');
            for (let i = 0; i < 50; i++) {
                const flake = document.createElement('div');
                flake.style.cssText = `
                    position: absolute;
                    background: white;
                    border-radius: 50%;
                    width: ${Math.random() * 4 + 2}px;
                    height: ${Math.random() * 4 + 2}px;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    opacity: ${Math.random() * 0.5 + 0.3};
                    animation: fall ${Math.random() * 10 + 10}s linear infinite;
                `;
                bg.appendChild(flake);
            }
            
            // æ·»åŠ åŠ¨ç”»å…³é”®å¸§
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fall {
                    0% { transform: translateY(-100px) rotate(0deg); }
                    100% { transform: translateY(100vh) rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
        }

        // åˆå§‹åŒ–ç”»æ¿
        function initCanvas() {
            const canvas = document.getElementById('drawingCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            let drawing = false;
            let currentColor = '#dc2626';
            
            ctx.lineWidth = 8;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.strokeStyle = currentColor;
            
            // é¢œè‰²é€‰æ‹©
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentColor = btn.dataset.color;
                    ctx.strokeStyle = currentColor;
                });
            });
            
            // ç»˜ç”»äº‹ä»¶
            canvas.addEventListener('mousedown', (e) => {
                drawing = true;
                if (!state.hasDrawn) {
                    state.hasDrawn = true;
                    state.achievements.paint = true;
                    updateProgress(20);
                    unlockBadge('badge4');
                    showToast('ğŸ¨ å¼€å§‹åˆ›ä½œï¼');
                    document.getElementById('nextPage5').innerHTML = '<i class="fas fa-arrow-right"></i> ç»§ç»­æ¢ç´¢';
                    document.getElementById('nextPage5').disabled = false;
                }
                ctx.beginPath();
                const rect = canvas.getBoundingClientRect();
                ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
            });
            
            canvas.addEventListener('mousemove', (e) => {
                if (!drawing) return;
                const rect = canvas.getBoundingClientRect();
                ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
                ctx.stroke();
            });
            
            canvas.addEventListener('mouseup', () => {
                drawing = false;
            });
            
            canvas.addEventListener('mouseout', () => {
                drawing = false;
            });
            
            // è§¦æ‘¸äº‹ä»¶
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                drawing = true;
                if (!state.hasDrawn) {
                    state.hasDrawn = true;
                    state.achievements.paint = true;
                    updateProgress(20);
                    unlockBadge('badge4');
                    showToast('ğŸ¨ å¼€å§‹åˆ›ä½œï¼');
                    document.getElementById('nextPage5').innerHTML = '<i class="fas fa-arrow-right"></i> ç»§ç»­æ¢ç´¢';
                    document.getElementById('nextPage5').disabled = false;
                }
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                ctx.beginPath();
                ctx.moveTo(touch.clientX - rect.left, touch.clientY - rect.top);
            });
            
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (!drawing) return;
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                ctx.lineTo(touch.clientX - rect.left, touch.clientY - rect.top);
                ctx.stroke();
            });
            
            canvas.addEventListener('touchend', () => {
                drawing = false;
            });
            
            // æ¸…ç©ºç”»å¸ƒ
            document.getElementById('clearCanvas').addEventListener('click', () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                showToast('ç”»æ¿å·²æ¸…ç©º');
            });
            
            // ä¿å­˜ä½œå“
            document.getElementById('saveDrawing').addEventListener('click', () => {
                const link = document.createElement('a');
                link.download = 'å¤§å¯’ç»˜ç”».png';
                link.href = canvas.toDataURL();
                link.click();
                showToast('ä½œå“å·²ä¿å­˜ï¼');
            });
            
            // çª—å£å¤§å°è°ƒæ•´
            window.addEventListener('resize', () => {
                const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
                ctx.putImageData(imgData, 0, 0);
                ctx.lineWidth = 8;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.strokeStyle = currentColor;
            });
        }

        // è®¾ç½®äº¤äº’
        function setupInteractions() {
            // å¯’å†·ç°è±¡ç‚¹å‡»
            document.querySelectorAll('.phenomenon-item').forEach(item => {
                item.addEventListener('click', () => {
                    if (!item.classList.contains('checked')) {
                        item.classList.add('checked');
                        state.phenomena.add(item.dataset.id);
                        
                        if (state.phenomena.size === 3) {
                            state.achievements.cold = true;
                            updateProgress(20);
                            unlockBadge('badge1');
                            showToast('â„ï¸ å¯’å†¬è§‚å¯Ÿè€…æˆå°±è§£é”ï¼');
                            document.getElementById('nextPage2').innerHTML = '<i class="fas fa-arrow-right"></i> ç»§ç»­æ¢ç´¢';
                            document.getElementById('nextPage2').disabled = false;
                        }
                    }
                });
            });
            
            // æ´»åŠ¨ç‚¹å‡»
            document.querySelectorAll('.activity-item').forEach(item => {
                item.addEventListener('click', () => {
                    const id = item.dataset.id;
                    const detail = activityDetails[id];
                    
                    // æ˜¾ç¤ºè¯¦æƒ…å¼¹çª—
                    document.getElementById('modalIcon').textContent = detail.icon;
                    document.getElementById('modalTitle').textContent = detail.title;
                    document.getElementById('modalBody').textContent = detail.desc;
                    document.getElementById('activityModal').classList.add('active');
                    
                    // æ”¶é›†æ´»åŠ¨
                    if (!item.classList.contains('collected')) {
                        item.classList.add('collected');
                        state.activities.add(id);
                        
                        if (state.activities.size === 4) {
                            state.achievements.activity = true;
                            updateProgress(20);
                            unlockBadge('badge2');
                            showToast('ğŸŒŸ æš–å¿ƒç”Ÿæ´»å®¶æˆå°±è§£é”ï¼');
                            document.getElementById('nextPage3').innerHTML = '<i class="fas fa-arrow-right"></i> ç»§ç»­æ¢ç´¢';
                            document.getElementById('nextPage3').disabled = false;
                        }
                    }
                });
            });
            
            // è¯—è¯é…å¯¹
            const poemPairs = { '1': '2', '4': '3' };
            let selectedPoem = null;
            
            document.querySelectorAll('.poem-line').forEach(poem => {
                poem.addEventListener('click', () => {
                    if (poem.classList.contains('matched')) return;
                    
                    if (!selectedPoem) {
                        selectedPoem = poem;
                        poem.classList.add('selected');
                    } else {
                        const first = selectedPoem.dataset.line;
                        const second = poem.dataset.line;
                        
                        if (poemPairs[first] === second || poemPairs[second] === first) {
                            selectedPoem.classList.remove('selected');
                            selectedPoem.classList.add('matched');
                            poem.classList.add('matched');
                            
                            state.poems.add(first);
                            
                            if (state.poems.size === 2) {
                                state.achievements.poem = true;
                                updateProgress(20);
                                unlockBadge('badge3');
                                showToast('ğŸ“š è¯—è¯çŸ¥éŸ³æˆå°±è§£é”ï¼');
                                document.getElementById('nextPage4').innerHTML = '<i class="fas fa-arrow-right"></i> ç»§ç»­æ¢ç´¢';
                                document.getElementById('nextPage4').disabled = false;
                            }
                        } else {
                            selectedPoem.classList.remove('selected');
                            showToast('å†è¯•ä¸€æ¬¡å§~');
                        }
                        selectedPoem = null;
                    }
                });
            });
            
            // å¼¹çª—å…³é—­
            document.getElementById('modalClose').addEventListener('click', () => {
                document.getElementById('activityModal').classList.remove('active');
            });
            
            document.getElementById('activityModal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('activityModal')) {
                    document.getElementById('activityModal').classList.remove('active');
                }
            });
            
            // ä¸‹ä¸€é¡µæŒ‰é’®
            for (let i = 2; i <= 5; i++) {
                document.getElementById(`nextPage${i}`).addEventListener('click', () => {
                    goToPage(state.currentPage + 1);
                });
            }
            
            // é‡æ–°å¼€å§‹æŒ‰é’®
            document.getElementById('restartBtn').addEventListener('click', () => {
                resetGame();
            });
        }

        // éŸ³ä¹æ§åˆ¶
        function initMusic() {
            const musicBtn = document.getElementById('musicBtn');
            const bgm = document.getElementById('bgm');
            let playing = false;
            
            musicBtn.addEventListener('click', () => {
                if (playing) {
                    bgm.pause();
                    musicBtn.innerHTML = '<i class="fas fa-music"></i>';
                    showToast('éŸ³ä¹å·²æš‚åœ');
                } else {
                    bgm.play().catch(() => {
                        showToast('ç‚¹å‡»é¡µé¢ä»»æ„å¤„å¯ç”¨éŸ³ä¹');
                        document.addEventListener('click', () => {
                            bgm.play();
                            musicBtn.innerHTML = '<i class="fas fa-pause"></i>';
                            playing = true;
                        }, { once: true });
                    });
                    musicBtn.innerHTML = '<i class="fas fa-pause"></i>';
                    showToast('â„ï¸ èŠ‚æ°”éŸ³ä¹æ’­æ”¾ä¸­');
                }
                playing = !playing;
            });
            
            // è‡ªåŠ¨æ’­æ”¾å°è¯•
            setTimeout(() => {
                bgm.play().catch(() => {
                    // è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œæ˜¾ç¤ºæç¤º
                    showToast('ç‚¹å‡»éŸ³ä¹æŒ‰é’®å¼€å¯èƒŒæ™¯éŸ³ä¹');
                });
            }, 1000);
        }

        // é¡µé¢å¯¼èˆª
        function goToPage(pageNum) {
            if (pageNum < 1 || pageNum > state.totalPages || isScrolling) return;
            
            isScrolling = true;
            const currentPage = document.getElementById(`page${state.currentPage}`);
            const nextPage = document.getElementById(`page${pageNum}`);
            
            // æ›´æ–°å½“å‰é¡µé¢çŠ¶æ€
            currentPage.classList.remove('active');
            if (pageNum > state.currentPage) {
                currentPage.classList.add('prev');
            } else {
                currentPage.classList.add('next');
            }
            
            // æ˜¾ç¤ºæ–°é¡µé¢
            nextPage.classList.remove('prev', 'next');
            nextPage.classList.add('active');
            
            state.currentPage = pageNum;
            
            // é‡ç½®æ»šåŠ¨çŠ¶æ€
            setTimeout(() => {
                isScrolling = false;
            }, 800);
        }

        // è§¦æ‘¸äº‹ä»¶å¤„ç†
        function handleTouchStart(e) {
            startY = e.touches[0].clientY;
        }

        function handleTouchEnd(e) {
            if (isScrolling) return;
            
            const endY = e.changedTouches[0].clientY;
            const diff = startY - endY;
            
            // æ»‘åŠ¨è·ç¦»é˜ˆå€¼
            if (Math.abs(diff) < 50) return;
            
            if (diff > 0) {
                // å‘ä¸Šæ»‘åŠ¨ - ä¸‹ä¸€é¡µ
                goToPage(state.currentPage + 1);
            } else {
                // å‘ä¸‹æ»‘åŠ¨ - ä¸Šä¸€é¡µ
                goToPage(state.currentPage - 1);
            }
        }

        // æ»šè½®äº‹ä»¶å¤„ç†
        function handleWheel(e) {
            if (isScrolling) return;
            
            e.preventDefault();
            
            if (e.deltaY > 0) {
                // å‘ä¸‹æ»šåŠ¨ - ä¸‹ä¸€é¡µ
                goToPage(state.currentPage + 1);
            } else {
                // å‘ä¸Šæ»šåŠ¨ - ä¸Šä¸€é¡µ
                goToPage(state.currentPage - 1);
            }
        }

        // é”®ç›˜æ”¯æŒ
        function handleKeydown(e) {
            if (isScrolling) return;
            
            if (e.key === 'ArrowDown' || e.key === 'PageDown') {
                goToPage(state.currentPage + 1);
            } else if (e.key === 'ArrowUp' || e.key === 'PageUp') {
                goToPage(state.currentPage - 1);
            }
        }

        // æ›´æ–°è¿›åº¦
        function updateProgress(add = 0) {
            if (add) state.progress = Math.min(100, state.progress + add);
            
            // æ£€æŸ¥æ‰€æœ‰æˆå°±
            const allAchieved = 
                state.achievements.cold &&
                state.achievements.activity &&
                state.achievements.poem &&
                state.achievements.paint;
            
            if (allAchieved && state.progress < 100) {
                state.progress = 100;
            }
            
            document.getElementById('progressFill').style.width = state.progress + '%';
            
            if (state.progress >= 100 && state.currentPage === 6) {
                showToast('ğŸ‰ å¤§å¯’èŠ‚æ°”æ¢ç´¢å®Œæˆï¼');
            }
        }

        // è§£é”å¾½ç« 
        function unlockBadge(id) {
            const badge = document.getElementById(id);
            badge.classList.add('unlocked');
        }

        // æ˜¾ç¤ºæç¤º
        function showToast(text) {
            const toast = document.getElementById('toast');
            toast.textContent = text;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            // é‡ç½®çŠ¶æ€
            state.currentPage = 1;
            state.phenomena.clear();
            state.activities.clear();
            state.poems.clear();
            state.hasDrawn = false;
            state.achievements = {
                cold: false,
                activity: false,
                poem: false,
                paint: false
            };
            state.progress = 0;
            
            // é‡ç½®UI
            document.querySelectorAll('.phenomenon-item').forEach(item => {
                item.classList.remove('checked');
            });
            
            document.querySelectorAll('.activity-item').forEach(item => {
                item.classList.remove('collected');
            });
            
            document.querySelectorAll('.poem-line').forEach(poem => {
                poem.classList.remove('selected', 'matched');
            });
            
            document.querySelectorAll('.badge').forEach(badge => {
                badge.classList.remove('unlocked');
            });
            
            // é‡ç½®ç”»å¸ƒ
            const canvas = document.getElementById('drawingCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // é‡ç½®æŒ‰é’®
            for (let i = 2; i <= 5; i++) {
                const btn = document.getElementById(`nextPage${i}`);
                btn.innerHTML = '<i class="fas fa-lock"></i> è¯·å…ˆå®Œæˆäº’åŠ¨';
                btn.disabled = true;
            }
            
            // è¿”å›ç¬¬ä¸€é¡µ
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active', 'prev', 'next');
            });
            document.getElementById('page1').classList.add('active');
            
            // é‡ç½®è¿›åº¦
            document.getElementById('progressFill').style.width = '0%';
            
            showToast('âœ¨ é‡æ–°å¼€å§‹æ¢ç´¢å¤§å¯’èŠ‚æ°”');
        }
    </script>
</body>
</html>
