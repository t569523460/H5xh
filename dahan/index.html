<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤§å¯’Â·å†¬è—æ˜¥ç”Ÿ | äº’åŠ¨èŠ‚æ°”H5</title>
    
    <!-- å¼•å…¥å­—ä½“å›¾æ ‡ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2c5282;
            --secondary-color: #e53e3e;
            --warm-color: #dd6b20;
            --cold-color: #63b3ed;
            --text-color: #2d3748;
            --light-bg: #f7fafc;
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #e6fffa 0%, #ebf8ff 100%);
            color: var(--text-color);
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }

        /* åŠ è½½ç•Œé¢ */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0c1b33 0%, #1a3a5f 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }

        .loader {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            border-top-color: #4fd1c7;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 1.2rem;
            letter-spacing: 2px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ä¸»å®¹å™¨ */
        .main-container {
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            min-height: 100vh;
        }

        /* èŠ‚æ°”ä¸»é¢˜å¤´å›¾ */
        .header-section {
            text-align: center;
            padding: 30px 20px;
            margin-bottom: 30px;
            background: linear-gradient(135deg, rgba(44, 82, 130, 0.9) 0%, rgba(100, 179, 237, 0.9) 100%);
            border-radius: 20px;
            color: white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .header-section::before {
            content: 'â„ï¸';
            position: absolute;
            font-size: 200px;
            opacity: 0.1;
            top: -40px;
            right: -40px;
        }

        .title {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* äº’åŠ¨å¡ç‰‡åŒºåŸŸ */
        .interaction-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .interaction-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            border: 1px solid #e2e8f0;
            cursor: pointer;
        }

        .interaction-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--cold-color), var(--primary-color));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-size: 1.5rem;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .card-content {
            line-height: 1.6;
            color: #4a5568;
            margin-bottom: 20px;
        }

        /* æ¸©åº¦è®¡äº’åŠ¨ */
        .thermometer {
            width: 100%;
            height: 200px;
            position: relative;
            background: #e2e8f0;
            border-radius: 25px;
            overflow: hidden;
            margin-top: 20px;
        }

        .temp-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%;
            background: linear-gradient(to top, #2b6cb0, #4299e1);
            transition: height 1.5s ease;
            border-radius: 25px;
        }

        .temp-marks {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 10px 20px;
            color: #4a5568;
            font-weight: 500;
        }

        .temp-slider {
            width: 100%;
            margin-top: 15px;
            -webkit-appearance: none;
            height: 8px;
            background: #cbd5e0;
            border-radius: 4px;
            outline: none;
        }

        .temp-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            background: var(--secondary-color);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        /* æ¢…èŠ±ç»˜åˆ¶æ¿ */
        .drawing-board {
            width: 100%;
            height: 200px;
            background: white;
            border: 2px dashed #cbd5e0;
            border-radius: 15px;
            margin-top: 15px;
            cursor: crosshair;
            touch-action: none;
        }

        .draw-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .draw-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s;
        }

        .draw-btn:hover {
            background: #2c5282;
        }

        /* ä¹ ä¿—æ”¶é›† */
        .customs-collection {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }

        .custom-item {
            padding: 12px 20px;
            background: #f7fafc;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            flex: 1;
            min-width: 120px;
        }

        .custom-item.collected {
            background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
            border-color: #68d391;
            transform: scale(1.05);
        }

        .custom-item:hover {
            transform: translateY(-3px);
        }

        /* è¯—è¯é…å¯¹ */
        .poem-matching {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .poem-line {
            padding: 15px;
            background: #f7fafc;
            border-radius: 10px;
            border: 2px solid #cbd5e0;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .poem-line.selected {
            background: #bee3f8;
            border-color: #4299e1;
        }

        .poem-line.matched {
            background: #c6f6d5;
            border-color: #68d391;
            cursor: default;
        }

        /* è¿›åº¦ç³»ç»Ÿ */
        .progress-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 40px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
        }

        .progress-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
        }

        .progress-container {
            width: 100%;
            height: 30px;
            background: #e2e8f0;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #38b2ac, #4299e1);
            width: 0%;
            transition: width 0.8s ease;
            border-radius: 15px;
        }

        .achievement-badges {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 25px;
        }

        .badge {
            width: 70px;
            height: 70px;
            background: #e2e8f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            transition: all 0.3s;
        }

        .badge.unlocked {
            background: linear-gradient(135deg, #f6e05e, #d69e2e);
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(214, 158, 46, 0.3);
        }

        /* éŸ³ä¹æ§åˆ¶ */
        .music-control {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 100;
        }

        .music-btn {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-color), var(--cold-color));
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }

        .music-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .title {
                font-size: 2rem;
            }
            
            .interaction-grid {
                grid-template-columns: 1fr;
            }
            
            .poem-matching {
                grid-template-columns: 1fr;
            }
            
            .music-control {
                bottom: 20px;
                right: 20px;
            }
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        /* æç¤ºä¿¡æ¯ */
        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            background: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            transform: translateX(150%);
            transition: transform 0.5s ease;
            border-left: 5px solid var(--secondary-color);
        }

        .toast.show {
            transform: translateX(0);
        }
    </style>
</head>
<body>
    <!-- åŠ è½½ç•Œé¢ -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loader"></div>
        <div class="loading-text">åŠ è½½èŠ‚æ°”éŸµå‘³...</div>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="main-container">
        <!-- èŠ‚æ°”å¤´å›¾ -->
        <header class="header-section floating">
            <h1 class="title">å¤§å¯’Â·å†¬è—æ˜¥ç”Ÿ</h1>
            <p class="subtitle">å²æœ«æœ€å¯’æ—¶ï¼Œä¸‡ç‰©å¾…æ–°ç”Ÿã€‚äºŒåå››èŠ‚æ°”ä¹‹å°¾ï¼Œå†¬çš„æ²‰æ·€ä¸æ˜¥çš„èŒåŠ¨åœ¨æ­¤äº¤æ±‡</p>
        </header>

        <!-- äº’åŠ¨å¡ç‰‡ç½‘æ ¼ -->
        <div class="interaction-grid">
            <!-- å¡ç‰‡1ï¼šæ¸©åº¦æ„ŸçŸ¥ -->
            <div class="interaction-card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-thermometer-half"></i>
                    </div>
                    <h3 class="card-title">å¤§å¯’æ¸©åº¦æ„ŸçŸ¥</h3>
                </div>
                <div class="card-content">
                    å¤§å¯’æ˜¯ä¸€å¹´ä¸­æœ€å†·çš„æ—¶èŠ‚ã€‚æ»‘åŠ¨è°ƒèŠ‚æ¸©åº¦è®¡ï¼Œæ„Ÿå—ä»åˆå†¬åˆ°å¤§å¯’çš„æ¸©åº¦å˜åŒ–ã€‚
                </div>
                <div class="thermometer">
                    <div class="temp-fill" id="tempFill"></div>
                    <div class="temp-marks">
                        <span>ç«‹å†¬</span>
                        <span>å°é›ª</span>
                        <span>å¤§é›ª</span>
                        <span>å†¬è‡³</span>
                        <span>å°å¯’</span>
                        <span>å¤§å¯’</span>
                    </div>
                </div>
                <input type="range" min="0" max="100" value="20" class="temp-slider" id="tempSlider">
                <div style="text-align: center; margin-top: 10px; font-size: 0.9rem; color: #718096;">
                    å½“å‰æ¸©åº¦ï¼š<span id="currentTemp">5</span>Â°C
                </div>
            </div>

            <!-- å¡ç‰‡2ï¼šä¹ ä¿—æ¢ç´¢ -->
            <div class="interaction-card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <h3 class="card-title">å¤§å¯’ä¹ ä¿—æ”¶é›†</h3>
                </div>
                <div class="card-content">
                    ç‚¹å‡»æ”¶é›†å¤§å¯’èŠ‚æ°”çš„ä¼ ç»Ÿä¹ ä¿—ï¼Œé›†é½æ‰€æœ‰ä¹ ä¿—è§£é”æˆå°±ï¼
                </div>
                <div class="customs-collection">
                    <div class="custom-item" data-custom="eat-rice">é£Ÿç³¯ç±³é¥­</div>
                    <div class="custom-item" data-custom="drink-soup">å–é¸¡æ±¤</div>
                    <div class="custom-item" data-custom="clean-house">é™¤å°˜å¸ƒæ–°</div>
                    <div class="custom-item" data-custom="prepare-spring">å¤‡å¹´è´§</div>
                </div>
                <div style="text-align: center; margin-top: 15px; font-size: 0.9rem; color: #718096;">
                    å·²æ”¶é›†ï¼š<span id="collectedCount">0</span>/4 é¡¹ä¹ ä¿—
                </div>
            </div>

            <!-- å¡ç‰‡3ï¼šè¯—è¯é…å¯¹ -->
            <div class="interaction-card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <h3 class="card-title">å¤§å¯’è¯—è¯é…å¯¹</h3>
                </div>
                <div class="card-content">
                    ç‚¹å‡»é€‰æ‹©ä¸Šä¸‹å¥ï¼Œé…å¯¹å®Œæ•´çš„å¤§å¯’è¯—è¯ã€‚
                </div>
                <div class="poem-matching">
                    <div class="poem-line" data-line="1">å¤§å¯’å®œè¿‘ç«</div>
                    <div class="poem-line" data-line="2">å°å¯’çŠ¹è‡ªè–„</div>
                    <div class="poem-line" data-line="3">æ— è¡£æ€å—å·</div>
                    <div class="poem-line" data-line="4">å¤§å¯’é›ªæœªæ¶ˆ</div>
                    <div class="poem-line" data-line="5">é—­æˆ·ä¸èƒ½å‡º</div>
                    <div class="poem-line" data-line="6">å›´ç‚‰è¯æ–°å¹´</div>
                </div>
                <div style="text-align: center; margin-top: 15px; font-size: 0.9rem; color: #718096;">
                    å·²é…å¯¹ï¼š<span id="matchedCount">0</span>/3 é¦–è¯—
                </div>
            </div>

            <!-- å¡ç‰‡4ï¼šæ¢…èŠ±ç»˜åˆ¶ -->
            <div class="interaction-card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-paint-brush"></i>
                    </div>
                    <h3 class="card-title">ç»˜åˆ¶å¯’æ¢…</h3>
                </div>
                <div class="card-content">
                    å¤§å¯’æ—¶èŠ‚ï¼Œæ¢…èŠ±ç‹¬æ”¾ã€‚ç”¨æ‰‹æŒ‡æˆ–é¼ æ ‡åœ¨ç”»æ¿ä¸Šç»˜åˆ¶å±äºä½ çš„å¯’æ¢…ã€‚
                </div>
                <canvas class="drawing-board" id="drawingBoard"></canvas>
                <div class="draw-controls">
                    <button class="draw-btn" id="clearCanvas">æ¸…ç©ºç”»æ¿</button>
                    <button class="draw-btn" id="saveDrawing">ä¿å­˜ä½œå“</button>
                    <select class="draw-btn" id="colorPicker" style="background: white; color: var(--text-color);">
                        <option value="#e53e3e">çº¢è‰²</option>
                        <option value="#2b6cb0">è“è‰²</option>
                        <option value="#38a169">ç»¿è‰²</option>
                        <option value="#000000">é»‘è‰²</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- è¿›åº¦ç³»ç»Ÿ -->
        <div class="progress-section">
            <h3 class="progress-title">èŠ‚æ°”æ¢ç´¢è¿›åº¦</h3>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div style="text-align: center; margin-top: 10px; color: #718096;">
                å®Œæˆæ‰€æœ‰äº’åŠ¨ä»¥è§£é”èŠ‚æ°”æˆå°±
            </div>
            
            <div class="achievement-badges">
                <div class="badge" id="badge1" title="æ¸©åº¦æ„ŸçŸ¥">
                    <i class="fas fa-thermometer-full"></i>
                </div>
                <div class="badge" id="badge2" title="ä¹ ä¿—æ”¶é›†">
                    <i class="fas fa-star"></i>
                </div>
                <div class="badge" id="badge3" title="è¯—è¯è¾¾äºº">
                    <i class="fas fa-feather-alt"></i>
                </div>
                <div class="badge" id="badge4" title="å¯’æ¢…ç”»å®¶">
                    <i class="fas fa-palette"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- éŸ³ä¹æ§åˆ¶ -->
    <div class="music-control">
        <button class="music-btn" id="musicToggle">
            <i class="fas fa-music"></i>
        </button>
    </div>

    <!-- æç¤ºæ¶ˆæ¯ -->
    <div class="toast" id="toast"></div>

    <!-- éŸ³é¢‘ -->
    <audio id="bgm" loop preload="auto" crossorigin="anonymous">
        <source src="https://assets.mixkit.co/music/preview/mixkit-hazy-after-hours-132.mp3" type="audio/mpeg">
    </audio>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // éšè—åŠ è½½ç•Œé¢
            setTimeout(() => {
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                }, 500);
            }, 1500);

            // åˆå§‹åŒ–å˜é‡
            let collectedCustoms = new Set();
            let matchedPoems = new Set();
            let progress = 0;
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;

            // å…ƒç´ å¼•ç”¨
            const elements = {
                tempFill: document.getElementById('tempFill'),
                tempSlider: document.getElementById('tempSlider'),
                currentTemp: document.getElementById('currentTemp'),
                collectedCount: document.getElementById('collectedCount'),
                matchedCount: document.getElementById('matchedCount'),
                progressBar: document.getElementById('progressBar'),
                toast: document.getElementById('toast'),
                musicToggle: document.getElementById('musicToggle'),
                bgm: document.getElementById('bgm'),
                drawingBoard: document.getElementById('drawingBoard'),
                clearCanvas: document.getElementById('clearCanvas'),
                saveDrawing: document.getElementById('saveDrawing'),
                colorPicker: document.getElementById('colorPicker')
            };

            // åˆå§‹åŒ–Canvas
            const ctx = elements.drawingBoard.getContext('2d');
            elements.drawingBoard.width = elements.drawingBoard.offsetWidth;
            elements.drawingBoard.height = elements.drawingBoard.offsetHeight;
            
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.strokeStyle = elements.colorPicker.value;

            // 1. æ¸©åº¦è®¡äº’åŠ¨
            elements.tempSlider.addEventListener('input', function() {
                const value = this.value;
                const temp = Math.round((value / 100) * 20 - 10); // -10Â°C åˆ° 10Â°C
                
                elements.tempFill.style.height = value + '%';
                elements.currentTemp.textContent = temp;
                
                // æ¸©åº¦è¾¾åˆ°æœ€ä½æ—¶æ˜¾ç¤ºæç¤º
                if (value > 90 && progress < 25) {
                    updateProgress(25);
                    showToast('æ„Ÿå—åˆ°å¤§å¯’çš„ä¸¥å¯’äº†ï¼');
                    document.getElementById('badge1').classList.add('unlocked');
                }
            });

            // 2. ä¹ ä¿—æ”¶é›†
            document.querySelectorAll('.custom-item').forEach(item => {
                item.addEventListener('click', function() {
                    if (this.classList.contains('collected')) return;
                    
                    const custom = this.dataset.custom;
                    collectedCustoms.add(custom);
                    this.classList.add('collected');
                    
                    elements.collectedCount.textContent = collectedCustoms.size;
                    
                    showToast(`æ”¶é›†äº†ä¹ ä¿—ï¼š${this.textContent}`);
                    
                    // æ”¶é›†è¿›åº¦
                    if (collectedCustoms.size === 4 && progress < 50) {
                        updateProgress(50);
                        showToast('æ­å–œï¼å·²æ”¶é›†æ‰€æœ‰å¤§å¯’ä¹ ä¿—ï¼');
                        document.getElementById('badge2').classList.add('unlocked');
                    }
                });
            });

            // 3. è¯—è¯é…å¯¹æ¸¸æˆ
            const poemPairs = {
                '1': '3', // å¤§å¯’å®œè¿‘ç« - æ— è¡£æ€å—å·
                '2': '6', // å°å¯’çŠ¹è‡ªè–„ - å›´ç‚‰è¯æ–°å¹´
                '4': '5'  // å¤§å¯’é›ªæœªæ¶ˆ - é—­æˆ·ä¸èƒ½å‡º
            };
            
            let selectedLine = null;
            
            document.querySelectorAll('.poem-line').forEach(line => {
                line.addEventListener('click', function() {
                    if (this.classList.contains('matched')) return;
                    
                    if (!selectedLine) {
                        // é€‰æ‹©ç¬¬ä¸€å¥
                        selectedLine = this;
                        this.classList.add('selected');
                        showToast('è¯·é€‰æ‹©å¯¹åº”çš„ä¸‹å¥');
                    } else {
                        // é€‰æ‹©ç¬¬äºŒå¥
                        const firstId = selectedLine.dataset.line;
                        const secondId = this.dataset.line;
                        
                        if (poemPairs[firstId] === secondId || poemPairs[secondId] === firstId) {
                            // é…å¯¹æˆåŠŸ
                            selectedLine.classList.remove('selected');
                            selectedLine.classList.add('matched');
                            this.classList.add('matched');
                            
                            const pairKey = poemPairs[firstId] ? firstId : secondId;
                            matchedPoems.add(pairKey);
                            elements.matchedCount.textContent = matchedPoems.size;
                            
                            showToast('è¯—è¯é…å¯¹æˆåŠŸï¼');
                            
                            // æ£€æŸ¥æ˜¯å¦å…¨éƒ¨é…å¯¹
                            if (matchedPoems.size === 3 && progress < 75) {
                                updateProgress(75);
                                showToast('è¯—è¯è¾¾äººæˆå°±è§£é”ï¼');
                                document.getElementById('badge3').classList.add('unlocked');
                            }
                        } else {
                            // é…å¯¹å¤±è´¥
                            selectedLine.classList.remove('selected');
                            showToast('é…å¯¹ä¸æ­£ç¡®ï¼Œå†è¯•è¯•å§ï¼');
                        }
                        
                        selectedLine = null;
                    }
                });
            });

            // 4. ç»˜åˆ¶å¯’æ¢…
            elements.drawingBoard.addEventListener('mousedown', startDrawing);
            elements.drawingBoard.addEventListener('mousemove', draw);
            elements.drawingBoard.addEventListener('mouseup', stopDrawing);
            elements.drawingBoard.addEventListener('mouseout', stopDrawing);
            
            // è§¦æ‘¸è®¾å¤‡æ”¯æŒ
            elements.drawingBoard.addEventListener('touchstart', function(e) {
                e.preventDefault();
                const touch = e.touches[0];
                startDrawing(touch);
            });
            
            elements.drawingBoard.addEventListener('touchmove', function(e) {
                e.preventDefault();
                const touch = e.touches[0];
                draw(touch);
            });
            
            elements.drawingBoard.addEventListener('touchend', stopDrawing);

            function startDrawing(e) {
                isDrawing = true;
                const rect = elements.drawingBoard.getBoundingClientRect();
                lastX = (e.clientX || e.pageX) - rect.left;
                lastY = (e.clientY || e.pageY) - rect.top;
            }

            function draw(e) {
                if (!isDrawing) return;
                
                const rect = elements.drawingBoard.getBoundingClientRect();
                const currentX = (e.clientX || e.pageX) - rect.left;
                const currentY = (e.clientY || e.pageY) - rect.top;
                
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(currentX, currentY);
                ctx.stroke();
                
                // ç»˜åˆ¶æ¢…èŠ±èŠ±ç“£ï¼ˆéšæœºï¼‰
                if (Math.random() > 0.7) {
                    drawFlower(currentX, currentY);
                }
                
                lastX = currentX;
                lastY = currentY;
                
                // æ£€æŸ¥ç»˜åˆ¶è¿›åº¦
                if (progress < 100) {
                    updateProgress(progress + 0.5);
                }
            }

            function drawFlower(x, y) {
                ctx.save();
                ctx.fillStyle = elements.colorPicker.value;
                
                for (let i = 0; i < 5; i++) {
                    const angle = (i * 72) * Math.PI / 180;
                    const petalX = x + Math.cos(angle) * 5;
                    const petalY = y + Math.sin(angle) * 5;
                    
                    ctx.beginPath();
                    ctx.arc(petalX, petalY, 4, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // èŠ±è•Š
                ctx.fillStyle = '#f6e05e';
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.restore();
            }

            function stopDrawing() {
                isDrawing = false;
                
                // ç»˜åˆ¶æˆå°±æ£€æŸ¥
                if (progress >= 95 && !document.getElementById('badge4').classList.contains('unlocked')) {
                    document.getElementById('badge4').classList.add('unlocked');
                    showToast('å¯’æ¢…ç”»å®¶æˆå°±è§£é”ï¼');
                }
            }

            elements.colorPicker.addEventListener('change', function() {
                ctx.strokeStyle = this.value;
            });

            elements.clearCanvas.addEventListener('click', function() {
                ctx.clearRect(0, 0, elements.drawingBoard.width, elements.drawingBoard.height);
                showToast('ç”»æ¿å·²æ¸…ç©º');
            });

            elements.saveDrawing.addEventListener('click', function() {
                const dataURL = elements.drawingBoard.toDataURL('image/png');
                const link = document.createElement('a');
                link.download = 'å¤§å¯’å¯’æ¢….png';
                link.href = dataURL;
                link.click();
                showToast('ä½œå“å·²ä¿å­˜ä¸ºå›¾ç‰‡ï¼');
            });

            // 5. éŸ³ä¹æ§åˆ¶
            let isPlaying = false;
            
            elements.musicToggle.addEventListener('click', function() {
                if (isPlaying) {
                    elements.bgm.pause();
                    this.innerHTML = '<i class="fas fa-music"></i>';
                    showToast('éŸ³ä¹å·²æš‚åœ');
                } else {
                    elements.bgm.play().catch(e => {
                        showToast('ç‚¹å‡»é¡µé¢ä»»æ„å¤„å¯ç”¨éŸ³ä¹');
                        document.body.addEventListener('click', function initMusic() {
                            elements.bgm.play();
                            document.body.removeEventListener('click', initMusic);
                        }, { once: true });
                    });
                    this.innerHTML = '<i class="fas fa-pause"></i>';
                    showToast('èŠ‚æ°”éŸ³ä¹æ’­æ”¾ä¸­');
                }
                isPlaying = !isPlaying;
            });

            // 6. è¿›åº¦æ›´æ–°å‡½æ•°
            function updateProgress(value) {
                progress = Math.max(progress, value);
                elements.progressBar.style.width = progress + '%';
                
                // å…¨éƒ¨å®Œæˆ
                if (progress >= 100) {
                    showToast('ğŸ‰ æ­å–œï¼å¤§å¯’èŠ‚æ°”æ¢ç´¢å®Œæˆï¼');
                }
            }

            // 7. æç¤ºæ¶ˆæ¯å‡½æ•°
            function showToast(message) {
                elements.toast.textContent = message;
                elements.toast.classList.add('show');
                
                setTimeout(() => {
                    elements.toast.classList.remove('show');
                }, 3000);
            }

            // 8. è‡ªé€‚åº”Canvaså¤§å°
            window.addEventListener('resize', function() {
                const oldImage = ctx.getImageData(0, 0, elements.drawingBoard.width, elements.drawingBoard.height);
                elements.drawingBoard.width = elements.drawingBoard.offsetWidth;
                elements.drawingBoard.height = elements.drawingBoard.offsetHeight;
                ctx.putImageData(oldImage, 0, 0);
            });

            // åˆå§‹åŒ–è¿›åº¦
            updateProgress(10);
        });
    </script>
</body>
</html>
